import { createContext as n, Component as t, toChildArray as r, cloneElement as i, h as o } from "./preact.module.js";import { useContext as e, useState as u, useEffect as f } from "./hooks.module.js";var a = {};function c(n, t) {for (var r in t) n[r] = t[r];return n;}function s(n, t, r) {var i,o = /(?:\?([^#]*))?(#.*)?$/,e = n.match(o),u = {};if (e && e[1]) for (var f = e[1].split("&"), c = 0; c < f.length; c++) {var s = f[c].split("=");u[decodeURIComponent(s[0])] = decodeURIComponent(s.slice(1).join("="));}n = d(n.replace(o, "")), t = d(t || "");for (var h = Math.max(n.length, t.length), v = 0; v < h; v++) if (t[v] && ":" === t[v].charAt(0)) {var l = t[v].replace(/(^:|[+*?]+$)/g, ""),p = (t[v].match(/[+*?]+$/) || a)[0] || "",m = ~p.indexOf("+"),y = ~p.indexOf("*"),U = n[v] || "";if (!U && !y && (p.indexOf("?") < 0 || m)) {i = !1;break;}if (u[l] = decodeURIComponent(U), m || y) {u[l] = n.slice(v).map(decodeURIComponent).join("/");break;}} else if (t[v] !== n[v]) {i = !1;break;}return (!0 === r.default || !1 !== i) && u;}function h(n, t) {return n.rank < t.rank ? 1 : n.rank > t.rank ? -1 : n.index - t.index;}function v(n, t) {return n.index = t, n.rank = function (n) {return n.props.default ? 0 : d(n.props.path).map(l).join("");}(n), n.props;}function d(n) {return n.replace(/(^\/+|\/+$)/g, "").split("/");}function l(n) {return ":" == n.charAt(0) ? 1 + "*+?".indexOf(n.charAt(n.length - 1)) || 4 : 5;}var p = {},m = [],y = [],U = null,g = { url: R() },k = n(g);function C() {var n = e(k);if (n === g) {var t = u()[1];f(function () {return y.push(t), function () {return y.splice(y.indexOf(t), 1);};}, []);}return [n, $];}function R() {var n;return "" + ((n = U && U.location ? U.location : U && U.getCurrentLocation ? U.getCurrentLocation() : "undefined" != typeof location ? location : p).pathname || "") + (n.search || "");}function $(n, t) {return void 0 === t && (t = !1), "string" != typeof n && n.url && (t = n.replace, n = n.url), function (n) {for (var t = m.length; t--;) if (m[t].canRoute(n)) return !0;return !1;}(n) && function (n, t) {void 0 === t && (t = "push"), U && U[t] ? U[t](n) : "undefined" != typeof history && history[t + "State"] && history[t + "State"](null, null, n);}(n, t ? "replace" : "push"), I(n);}function I(n) {for (var t = !1, r = 0; r < m.length; r++) m[r].routeTo(n) && (t = !0);return t;}function M(n) {if (n && n.getAttribute) {var t = n.getAttribute("href"),r = n.getAttribute("target");if (t && t.match(/^\//g) && (!r || r.match(/^_?self$/i))) return $(t);}}function b(n) {return n.stopImmediatePropagation && n.stopImmediatePropagation(), n.stopPropagation && n.stopPropagation(), n.preventDefault(), !1;}function W(n) {if (!(n.ctrlKey || n.metaKey || n.altKey || n.shiftKey || n.button)) {var t = n.target;do {if ("a" === t.localName && t.getAttribute("href")) {if (t.hasAttribute("data-native") || t.hasAttribute("native")) return;if (M(t)) return b(n);}} while (t = t.parentNode);}}var w = !1;function D(n) {n.history && (U = n.history), this.state = { url: n.url || R() };}c(D.prototype = new t(), { shouldComponentUpdate: function (n) {return !0 !== n.static || n.url !== this.props.url || n.onChange !== this.props.onChange;}, canRoute: function (n) {var t = r(this.props.children);return void 0 !== this.g(t, n);}, routeTo: function (n) {this.setState({ url: n });var t = this.canRoute(n);return this.p || this.forceUpdate(), t;}, componentWillMount: function () {this.p = !0;}, componentDidMount: function () {var n = this;w || (w = !0, U || addEventListener("popstate", function () {I(R());}), addEventListener("click", W)), m.push(this), U && (this.u = U.listen(function (t) {var r = t.location || t;n.routeTo("" + (r.pathname || "") + (r.search || ""));})), this.p = !1;}, componentWillUnmount: function () {"function" == typeof this.u && this.u(), m.splice(m.indexOf(this), 1);}, componentWillUpdate: function () {this.p = !0;}, componentDidUpdate: function () {this.p = !1;}, g: function (n, t) {n = n.filter(v).sort(h);for (var r = 0; r < n.length; r++) {var i = n[r],o = s(t, i.props.path, i.props);if (o) return [i, o];}}, render: function (n, t) {var e,u,f = n.onChange,a = t.url,s = this.c,h = this.g(r(n.children), a);if (h && (u = i(h[0], c(c({ url: a, matches: e = h[1] }, e), { key: void 0, ref: void 0 }))), a !== (s && s.url)) {c(g, s = this.c = { url: a, previous: s && s.url, current: u, path: u ? u.props.path : null, matches: e }), s.router = this, s.active = u ? [u] : [];for (var v = y.length; v--;) y[v]({});"function" == typeof f && f(s);}return o(k.Provider, { value: s }, u);} });var E = function (n) {return o("a", c({ onClick: W }, n));},L = function (n) {return o(n.component, n);};export { E as Link, L as Route, D as Router, D as default, s as exec, R as getCurrentUrl, $ as route, C as useRouter };
